{% extends 'base.html' %}
{% load static %}

{% block title %}Delete Task - Employee Task Manager{% endblock %}

{% block extra_css %}
<style>
.delete-warning {
    background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
    color: white;
    border-radius: 0.5rem;
    padding: 2rem;
    margin-bottom: 2rem;
}

.task-info-card {
    background: white;
    border-radius: 0.5rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    border: none;
}

.danger-icon {
    font-size: 4rem;
    color: #dc3545;
    margin-bottom: 1rem;
}

.priority-indicator {
    padding: 0.25rem 0.75rem;
    border-radius: 1rem;
    font-size: 0.875rem;
    font-weight: 500;
}

.priority-high { background-color: #dc3545; color: white; }
.priority-medium { background-color: #ffc107; color: #000; }
.priority-low { background-color: #28a745; color: white; }
.priority-urgent { background-color: #6f42c1; color: white; }

.status-indicator {
    padding: 0.25rem 0.75rem;
    border-radius: 1rem;
    font-size: 0.875rem;
    font-weight: 500;
}

.status-pending { background-color: #6c757d; color: white; }
.status-in_progress { background-color: #007bff; color: white; }
.status-completed { background-color: #28a745; color: white; }
.status-cancelled { background-color: #dc3545; color: white; }

.confirmation-actions {
    background: #f8f9fa;
    border-radius: 0.5rem;
    padding: 2rem;
    text-align: center;
}
</style>
{% endblock %}

{% block content %}
<main class="container py-4">
    <!-- Warning Header -->
    <div class="delete-warning text-center">
        <i class="fas fa-exclamation-triangle danger-icon"></i>
        <h1 class="display-5 mb-3">Delete Task</h1>
        <p class="lead mb-0">This action cannot be undone. Please confirm that you want to delete this task.</p>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Task Information -->
            <div class="task-info-card p-4 mb-4">
                <h2 class="h4 mb-4">Task Details</h2>
                
                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Title:</strong>
                    </div>
                    <div class="col-sm-9">
                        {{ task.title }}
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Description:</strong>
                    </div>
                    <div class="col-sm-9">
                        {{ task.description|truncatechars:200 }}
                        {% if task.description|length > 200 %}
                            <a href="#" data-bs-toggle="modal" data-bs-target="#fullDescriptionModal">...read more</a>
                        {% endif %}
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Assigned To:</strong>
                    </div>
                    <div class="col-sm-9">
                        {{ task.assigned_to.get_full_name }} ({{ task.assigned_to.username }})
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Created By:</strong>
                    </div>
                    <div class="col-sm-9">
                        {{ task.created_by.get_full_name }} ({{ task.created_by.username }})
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Priority:</strong>
                    </div>
                    <div class="col-sm-9">
                        <span class="priority-indicator priority-{{ task.priority }}">
                            {{ task.get_priority_display }}
                        </span>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Status:</strong>
                    </div>
                    <div class="col-sm-9">
                        <span class="status-indicator status-{{ task.status }}">
                            {{ task.get_status_display }}
                        </span>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Due Date:</strong>
                    </div>
                    <div class="col-sm-9">
                        {{ task.due_date|date:"F d, Y" }} at {{ task.due_date|time:"g:i A" }}
                        {% if task.is_overdue %}
                            <span class="badge bg-danger ms-2">Overdue</span>
                        {% endif %}
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Created:</strong>
                    </div>
                    <div class="col-sm-9">
                        {{ task.created_at|date:"F d, Y" }} at {{ task.created_at|time:"g:i A" }}
                    </div>
                </div>

                {% if task.completed_at %}
                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Completed:</strong>
                    </div>
                    <div class="col-sm-9">
                        {{ task.completed_at|date:"F d, Y" }} at {{ task.completed_at|time:"g:i A" }}
                    </div>
                </div>
                {% endif %}

                {% if task.comments.exists %}
                <div class="row">
                    <div class="col-sm-3">
                        <strong>Comments:</strong>
                    </div>
                    <div class="col-sm-9">
                        <span class="badge bg-info">{{ task.comments.count }} comment{{ task.comments.count|pluralize }}</span>
                        <small class="text-muted ms-2">All comments will also be deleted</small>
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Confirmation Actions -->
            <div class="confirmation-actions">
                <div class="alert alert-danger mb-4" role="alert">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Warning:</strong> Deleting this task will permanently remove it and all associated comments. This action cannot be undone.
                </div>

                <form method="post" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger btn-lg me-3" onclick="return confirmDelete()">
                        <i class="fas fa-trash-alt me-2"></i>
                        Yes, Delete Task
                    </button>
                </form>

                <a href="{% url 'tasks:task_detail' task.id %}" class="btn btn-secondary btn-lg">
                    <i class="fas fa-arrow-left me-2"></i>
                    Cancel
                </a>

                <div class="mt-3">
                    <small class="text-muted">
                        You can also return to the 
                        <a href="{% url 'tasks:task_list' %}">task list</a> or 
                        <a href="{% url 'core:dashboard' %}">dashboard</a>.
                    </small>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Full Description Modal -->
{% if task.description|length > 200 %}
<div class="modal fade" id="fullDescriptionModal" tabindex="-1" aria-labelledby="fullDescriptionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="fullDescriptionModalLabel">Full Task Description</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h6 class="fw-bold">{{ task.title }}</h6>
                <p class="mb-0">{{ task.description|linebreaks }}</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
function confirmDelete() {
    return confirm('Are you absolutely sure you want to delete this task? This action cannot be undone.');
}

// Auto focus on cancel button for better UX
document.addEventListener('DOMContentLoaded', function() {
    document.querySelector('.btn-secondary').focus();
});
</script>
{% endblock %}